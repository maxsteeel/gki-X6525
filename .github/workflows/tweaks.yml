name: Build GKI Kernel (tweaks branch)
on:
  workflow_dispatch:
jobs:
  build:
    name: Build Kernel
    runs-on: buildjet-64vcpu-ubuntu-latest
    steps:
      - name: Clone Kernel Source with Submodules
        run: |
          git clone --recurse-submodules https://github.com/maxsteeel/android_kernel_unisoc -b tweaks common -j$(nproc --all)
      - name: Build Kernel
        run: |
          cd common
          make O="out" unisoc_defconfig
          make O="out" Image
      - name: Repack in AnyKernel3 zip
        run: |
          git clone https://github.com/maxsteeel/AnyKernel3
          cp -rf common/out/arch/arm64/boot/Image AnyKernel3
      - name: Upload Kernel (Image)
        uses: actions/upload-artifact@v4
        with:
          name: AnyKernel3-MaxKernel-tweaks
          path: AnyKernel3/*
